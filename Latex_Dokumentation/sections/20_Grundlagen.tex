\chapter{Grundlagen}

\section{JDroid Library}
\sectionauthor{\philipp}

Die wichtigste Komponente der Kartenspiele ist die JDroid library. Die von
\href{http://www.aplu.ch/home/apluhomex.jsp?site=99}{Äegidius Plüss} entwickelte
Java Bibliothek implementiert ebenfalls die JCardGame Bibliothek für Android,
welche grundlegend für unsere Kartenspiele ist. Sie verfügt über eine
ausführliche
\href{http://www.java-online.ch/gamegrid/index.php?inhalt_links=navigation.inc.php&inhalt_mitte=iframedoc1.html}{Dokumentation}.
Im Folgenden werde ich die wichtigsten von uns genutzten Funktionen der
Bibliothek erklären.

\subsection{Rank und Suit enum}

Zu Anfang muss man die Farben und Wertigkeiten der Karten in Form eines Enums
festlegen. Karten werden durch Sprites dargestellt, die man in drawables ablegt.
Durch die Namensgebung der Sprites ordnet die Bibliothek die Sprites der
richtigen Karte zu. Angenommen die Reihenfolge der Ranks lautet:

Ass, Ober, Unter, Zehn, König, usw.

und die der Suits sei:

Eichel, Grün, Herz, Schellen

, wäre der korrekte Name für das Sprite für die Eichel Ass: eichel0.gif, für den
Eichel Ober: eichel1.gif, und so weiter.

\subsection{Locations}

Um Hände und Kartenstapel anzeigen zu können, muss man zunächst im Konstruktor
ein Board erstellen, und Ausrichtung, Farbe, sowie \code{windowZoom(int)}
angeben. Der windowZoom unterteilt den Bildschirm in Zellen relativ zur
Bildschirmgröße, um darauf sogenannte Locations anzulegen, auf welchen man
Karten oder Textfelder ablegen kann.

Am Beispiel Schafkopf haben wir 3 Location Arrays genutzt:

\begin{itemize}
	\item \code{HandLocations} (Für alle 2er Kartenstapel)
	\item \code{StackLocations} (Zwei Ablage Stapel für gestochene Karten)
	\item \code{BidLocations} (Zwei Stapel um einen Stich zu berechnen)
\end{itemize}

\subsection{Einstiegspunkt und initPlayers}

Anders als normal ist der Einstiegspunkt nicht in \code{OnCreate()}, sondern
wurde durch die Bibliothek überschrieben und startet deshalb in \code{main()}.
Dort werden das Deck auf Basis der enums, sämtliche Locations, die Hände und
die Spieler initialisiert. In \code{initPlayers()} läuft das Spielgeschehen ab:
es wird dem Spieler, der soeben an der Reihe ist, der CardListener hinzugefügt
und \code{longPressed(Card card)} wartet darauf, dass eine Karte gedrückt
gehalten wird. Wurde eine Karte ausgewählt, wird sie auf den jeweiligen
\emph{bid} transferiert und \code{atTarget()} wertet den Stich dann aus und
/ oder gibt einen Marker für den aktiven Spieler mittels der Methode
\code{setPlayerMove(int playerWon)} weiter, welche jeweils
\code{setTouchEnable(}) der einzelnen Kartenstapel auf true oder false setzt.

\subsection{Deck und Hands}

Das Deck wird initialisiert aus allen Suits und Ranks, die man Anfangs
innerhalb der enums festgelegt hat. Zudem legt man ebenfalls fest, wie die
Kartenrückseite aussehen soll. Anschließend wird mit einer vorgegebenen Methode
gemischt und ausgeteilt:

\code{dealingOut(int AnzahlHände, int AnzahlKarten, Boolean Mischen)}

Eine Hand beinhaltet Kartenobjekte und verwaltet diese. Sprich Stack, bids und
die Spieler Hände bestehen alle aus Hand-Objekten, die auf bestimmten Locations
angezeigt werden. Mittels \code{stacks[i].setView(board, new
StackLayout(stackLocations[i])} legt man diese Locations für jede Hand einzeln
fest und zeigt sie mit \code{stacks[i].draw()} an.

\subsection{Textactor}

Textactor sind Textfelder, welche man auf bestimmten Locations anzeigen lassen
kann. Da sie als einziges sowohl im Schafkopf für die verbleibenden Karten, als
auch als Punkteanzeige verwendet werden, ist es wichtig, sie an dieser Stelle
zu erläutern. Zuerst muss ein Textactor mit einem String initialisiert werden
-- zum Beispiel mit der Anzahl der Karten des ersten 2er Stapels. Desweiteren
braucht jeder Actor eine Location. Mit \code{addActor(TextActor, Location)}
zeigt man den Actor auf dem Board an, und mit \code{removeActor(TextActor)}
wird dieser wieder entfernt.

\section{Carballo Library}
\sectionauthor{\oliver}
Da zusätzlich eine eigene Schach-Library zu schreiben den Ramen des 
Programmierprojektes sprengen würde wird eine Library für die Schach-Logik 
verwendet. Nachdem anfangs die Library 
\href{http://www.chesspresso.org/}{Chesspresso} verwendet wurde, wurde bald 
danach auf die \href{https://github.com/albertoruibal/carballo}{Carballo} 
Library gewechselt, da diese eine erhöhte Funktionalität und 
Benutzerfreundlichkeit aufweist. Trotz einer fehlenden Dokumentation und nur 
sehr bedingt auffindbaren Kommentaren konnte mit Hilfe des Quellcodes der 
Webseite \href{https://www.mobialia.com/webchessgwt/}{www.mobilia.com} welche 
ebenfalls Carballo als Engine verwendet die Library zum laufen gebracht werden.

\subsection{Board}
Die Klasse \code{Board} stellt das Spielfeld dar. Es kann je nach belieben mit 
einem FEN-String initialisiert werden oder einfach mit der standard Schach 
Aufstellung beginnen. Alle wichtigen Funktionen, wir das setzen und Rückgängig 
machen von Zügen und das ausgeben des Spielfeldes als FEN-String werden hier 
untergebracht. Beim erschaffen des Boardes ist darauf zu achten, das man bei 
Benutzung der KI das Board nicht selber erstellt wird, sondern aus der 
\code{SearchEngine} bekommt, nachdem diese Wiederum mit einer \code{Config} 
gestartet wurde, da ansonsten KI und Spieler auf unterschiedlichen Boards 
spielen würden.
